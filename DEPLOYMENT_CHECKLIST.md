# ✅ 部署检查清单

完整的部署前、部署中、部署后检查清单。

---

## 📋 打包前检查

### 环境检查

- [ ] Python 3.11+ 已安装
- [ ] Node.js 18+ 已安装
- [ ] Rust 最新版已安装
- [ ] uv 已安装
- [ ] Git 已安装（可选）

### 依赖检查

```bash
# Backend
cd backend
uv pip list | findstr pyinstaller  # 确认已安装

# Desktop
cd desktop
npm list qrcode  # 确认已安装
```

### 代码检查

- [ ] Backend 本地运行正常
- [ ] Desktop 本地运行正常
- [ ] 小程序本地运行正常
- [ ] WebSocket 通信正常
- [ ] 数据库初始化正常

---

## 📦 打包过程检查

### Backend 打包

```bash
cd backend
python build_exe.py
```

- [ ] 打包成功（无错误）
- [ ] `dist/smartmart-backend.exe` 已生成
- [ ] 文件大小合理（50-80 MB）
- [ ] 手动测试可运行

**测试命令**:
```bash
cd backend\dist
.\smartmart-backend.exe --host 127.0.0.1 --port 8000
# 访问 http://localhost:8000/docs
```

### Desktop 打包

```bash
cd desktop
npm run tauri build
```

- [ ] 打包成功（无错误）
- [ ] MSI 安装包已生成
- [ ] 文件大小合理（20-40 MB）
- [ ] NSIS 安装包已生成（可选）

**输出位置**:
- `desktop/src-tauri/target/release/bundle/msi/SmartMart_*.msi`
- `desktop/src-tauri/target/release/bundle/nsis/SmartMart_*-setup.exe`

---

## 🔥 防火墙配置检查

### 自动配置

```powershell
# 以管理员身份运行
.\add_firewall_rule.ps1
```

- [ ] 脚本运行成功
- [ ] 规则已添加
- [ ] 规则已启用

### 验证规则

```powershell
# 查看规则
netsh advfirewall firewall show rule name="SmartMart Backend Service"
```

**期望输出**:
- 规则名称: SmartMart Backend Service
- 已启用: 是
- 方向: 入站
- 操作: 允许
- 配置文件: 专用,域

---

## 🚀 安装测试

### 安装过程

- [ ] 双击 MSI 安装包
- [ ] 安装向导正常运行
- [ ] 选择安装目录
- [ ] 安装完成无错误
- [ ] 桌面/开始菜单快捷方式已创建

### 首次启动

- [ ] 应用正常启动
- [ ] 无崩溃或错误弹窗
- [ ] Backend 进程已启动

**验证 Backend**:
```bash
# 检查进程
tasklist | findstr smartmart-backend

# 测试 API
curl http://localhost:8000/health
```

---

## 🔗 配对功能测试

### Desktop 端

- [ ] 进入"设备配对"页面
- [ ] 点击"生成配对码"
- [ ] 二维码正常显示
- [ ] 倒计时正常
- [ ] 本机 IP 正确显示
- [ ] Token 信息显示

### 小程序端

- [ ] 小程序正常启动
- [ ] 进入首页
- [ ] 点击"扫码配对"
- [ ] 扫描二维码
- [ ] 自动填入地址
- [ ] WebSocket 连接成功
- [ ] 连接状态显示"已连接"

### Token 验证

- [ ] Token 有效期 5 分钟
- [ ] Token 过期后无法连接
- [ ] Token 使用后无法重复使用
- [ ] 刷新二维码生成新 Token

---

## 🔒 安全检查

### 局域网限制

**测试步骤**:
1. 在同一局域网的其他设备访问
2. 从公网尝试访问（应被拒绝）

- [ ] 局域网设备可以访问
- [ ] 127.0.0.1 可以访问
- [ ] 公网 IP 无法访问（如有）
- [ ] 错误提示清晰

### Token 鉴权

- [ ] 无 Token 连接被拒绝
- [ ] 错误 Token 被拒绝
- [ ] 过期 Token 被拒绝
- [ ] 有效 Token 可连接

### 防火墙规则

- [ ] 仅允许专用网络
- [ ] 不允许公用网络
- [ ] 程序规则生效
- [ ] 端口 8000 开放

---

## 💼 功能完整性测试

### 收银功能

- [ ] 扫码枪输入正常
- [ ] 商品查询成功
- [ ] 购物车操作正常
- [ ] 提交订单成功
- [ ] 库存自动扣减

### 小程序功能

- [ ] 扫码功能正常
- [ ] WebSocket 通信正常
- [ ] 拍照识别功能正常（如已实现）
- [ ] Toast 提示正常

### 报表功能

- [ ] 日报表数据正确
- [ ] 月报表数据正确
- [ ] 热销商品统计正确
- [ ] 滞销商品统计正确

### AI 分析

- [ ] 补货建议合理
- [ ] 异常检测准确
- [ ] 算法说明清晰
- [ ] 数据可视化正常

---

## 📱 多设备测试

### Windows PC 1

- [ ] 安装成功
- [ ] 运行正常
- [ ] 配对功能正常

### 手机 1 (iOS/Android)

- [ ] 小程序运行正常
- [ ] 扫码配对成功
- [ ] WebSocket 连接稳定
- [ ] 功能正常使用

### 手机 2 (iOS/Android)

- [ ] 多设备同时连接
- [ ] 消息广播正常
- [ ] 无连接冲突

---

## 🌐 网络环境测试

### 同一路由器

- [ ] PC 和手机同网段
- [ ] 配对成功
- [ ] 通信正常
- [ ] 延迟低

### 不同 Wi-Fi（同网段）

- [ ] 配对成功
- [ ] 通信正常

### 移动热点

- [ ] 手机开热点，PC 连接
- [ ] 配对成功
- [ ] 通信正常

---

## 📊 性能测试

### Backend 性能

- [ ] 启动时间 < 5 秒
- [ ] API 响应 < 100ms
- [ ] WebSocket 延迟 < 50ms
- [ ] 内存占用 < 200MB
- [ ] CPU 占用 < 5%（空闲时）

### Desktop 性能

- [ ] 启动时间 < 3 秒
- [ ] UI 响应流畅
- [ ] 内存占用 < 300MB
- [ ] 扫码枪输入无延迟

### 数据库性能

- [ ] 查询速度 < 10ms
- [ ] 插入速度 < 20ms
- [ ] 数据库大小增长合理

---

## 🐛 异常处理测试

### 网络异常

- [ ] 断网后提示明确
- [ ] 重连后自动恢复
- [ ] 数据不丢失

### 进程异常

- [ ] Backend 崩溃后可重启
- [ ] Desktop 崩溃后可重启
- [ ] 数据库损坏有提示

### 输入异常

- [ ] 无效条码提示清晰
- [ ] 空购物车提示
- [ ] 库存不足提示
- [ ] 重复提交防护

---

## 📝 文档检查

### 用户文档

- [ ] README.md 完整
- [ ] 快速开始指南清晰
- [ ] 功能说明详细
- [ ] 常见问题解答

### 技术文档

- [ ] API 文档完整
- [ ] 数据库设计文档
- [ ] 部署指南详细
- [ ] 架构说明清晰

### 截图和演示

- [ ] 功能截图清晰
- [ ] 操作流程图完整
- [ ] 配对流程说明
- [ ] 演示视频（可选）

---

## 🎯 最终验收

### 功能完整性

- [ ] 所有核心功能正常
- [ ] 无严重 Bug
- [ ] 性能达标
- [ ] 安全措施到位

### 用户体验

- [ ] 操作流程顺畅
- [ ] 界面美观
- [ ] 提示信息友好
- [ ] 响应速度快

### 可维护性

- [ ] 代码结构清晰
- [ ] 注释完整
- [ ] 文档齐全
- [ ] 易于更新

---

## ✅ 签署确认

完成所有检查项后，填写以下信息：

**测试人员**: ___________________

**测试日期**: ___________________

**测试环境**:
- Windows 版本: ___________________
- 网络环境: ___________________
- 设备型号: ___________________

**发现问题**: 
1. ___________________
2. ___________________
3. ___________________

**总体评价**: ⭐⭐⭐⭐⭐ (1-5星)

**是否通过**: [ ] 通过  [ ] 不通过

**备注**: 
___________________________________________________
___________________________________________________
___________________________________________________

---

## 🎉 完成！

所有检查项通过后，即可交付使用！

**下一步**:
1. 打包所有文件（安装包、文档、脚本）
2. 准备用户手册
3. 进行用户培训
4. 部署到生产环境
5. 持续监控和支持


