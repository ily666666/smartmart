# SmartMart 微信小程序

微信小程序 店小蜜  采集器，用于扫码、拍照识别商品，并通过 WebSocket 发送给桌面端。

## 功能特性

- **扫码功能**: 扫描商品条码
- **拍照识别**: 拍摄商品照片，发送给 AI 识别
- **WebSocket 通信**: 实时与后端/桌面端通信
- **商品查询**: 查看商品信息、库存
- **局域网通信**: 适用于本地超市环境

## 开发工具

需要安装 [微信开发者工具](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)

## 开发步骤

### 1. 导入项目

1. 打开微信开发者工具
2. 选择"导入项目"
3. 选择 `miniapp` 目录
4. 填写 AppID（测试可以使用测试号）

### 2. 配置服务器地址

在 `config.js` 中配置后端服务地址：

```javascript
export const API_BASE_URL = 'http://192.168.1.100:8000';  // 替换为你的局域网地址
export const WS_URL = 'ws://192.168.1.100:8000/ws';
```

### 3. 配置小程序信息

在微信公众平台配置：

1. **服务器域名**: 添加你的局域网地址（开发环境可勾选"不校验合法域名"）
2. **扫码权限**: 确保已开通扫码权限
3. **相机权限**: 确保已开通相机权限

### 4. 预览和调试

1. 点击"编译"按钮
2. 使用"预览"功能在手机上测试
3. 或直接在模拟器中调试

## 项目结构

```
miniapp/
├── pages/                  # 页面
│   ├── index/             # 首页
│   │   ├── index.js
│   │   ├── index.json
│   │   ├── index.wxml
│   │   └── index.wxss
│   ├── scan/              # 扫码页
│   │   ├── scan.js
│   │   ├── scan.json
│   │   ├── scan.wxml
│   │   └── scan.wxss
│   └── camera/            # 拍照页
│       ├── camera.js
│       ├── camera.json
│       ├── camera.wxml
│       └── camera.wxss
├── utils/                  # 工具函数
│   ├── websocket.js       # WebSocket 封装
│   └── api.js             # API 请求封装
├── app.js                  # 小程序入口
├── app.json                # 全局配置
├── app.wxss                # 全局样式
├── project.config.json     # 项目配置
├── sitemap.json           # 站点地图
├── config.js              # 应用配置
├── package.json
└── README.md              # 本文件
```

## 使用方法

### 扫码添加商品

1. 打开小程序
2. 点击"扫码"按钮
3. 扫描商品条码
4. 商品信息会自动发送到桌面端

### 拍照识别商品

1. 点击"拍照"按钮
2. 拍摄商品照片
3. 照片会发送到后端 AI 识别
4. 识别结果返回到桌面端

### WebSocket 状态

- 绿色圆点: 已连接
- 红色圆点: 未连接
- 小程序会自动重连

## 注意事项

1. **局域网访问**: 确保手机和后端服务在同一局域网
2. **HTTPS 限制**: 开发环境可以勾选"不校验合法域名"
3. **权限申请**: 首次使用会申请相机、扫码权限
4. **WebSocket 连接**: 小程序后台会断开 WebSocket，需重连

## 调试技巧

1. 使用 `console.log()` 查看日志
2. 在"调试器"中查看网络请求
3. 使用"模拟器"测试基本功能
4. 使用"真机调试"测试扫码和拍照

## 发布

1. 点击"上传"按钮
2. 填写版本号和描述
3. 在微信公众平台提交审核
4. 审核通过后发布


