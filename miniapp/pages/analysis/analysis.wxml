<view class="page-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <text class="header-icon">ğŸ¤–</text>
    <view class="header-text">
      <text class="header-title">æ™ºèƒ½åˆ†æ</text>
      <text class="header-desc">AI å¸®æ‚¨åšå†³ç­–</text>
    </view>
  </view>

  <!-- Tab åˆ‡æ¢ -->
  <view class="tab-bar">
    <view 
      class="tab-item {{activeTab === 'restock' ? 'active' : ''}}"
      data-tab="restock"
      bindtap="switchTab"
    >
      <text class="tab-icon">ğŸ“¦</text>
      <text class="tab-text">è¡¥è´§å»ºè®®</text>
    </view>
    <view 
      class="tab-item {{activeTab === 'anomaly' ? 'active' : ''}}"
      data-tab="anomaly"
      bindtap="switchTab"
    >
      <text class="tab-icon">ğŸ”</text>
      <text class="tab-text">å¼‚å¸¸æ£€æµ‹</text>
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-state" wx:if="{{loading}}">
    <text class="loading-icon">â³</text>
    <text class="loading-text">æ­£åœ¨åˆ†æ...</text>
  </view>

  <!-- è¡¥è´§å»ºè®® -->
  <view class="tab-content" wx:if="{{activeTab === 'restock' && !loading}}">
    <!-- è®¾ç½®åŒºåŸŸ -->
    <view class="settings-section">
      <view class="setting-row">
        <text class="setting-label">ğŸ“… ç»Ÿè®¡å‘¨æœŸ</text>
        <view class="setting-options">
          <view 
            class="option-btn {{days === 7 ? 'active' : ''}}"
            data-days="7"
            bindtap="setDays"
          >7å¤©</view>
          <view 
            class="option-btn {{days === 15 ? 'active' : ''}}"
            data-days="15"
            bindtap="setDays"
          >15å¤©</view>
          <view 
            class="option-btn {{days === 30 ? 'active' : ''}}"
            data-days="30"
            bindtap="setDays"
          >30å¤©</view>
        </view>
      </view>
      <view class="setting-row">
        <text class="setting-label">ğŸ›¡ï¸ å®‰å…¨å¤©æ•°</text>
        <view class="setting-options">
          <view 
            class="option-btn {{safetyStockDays === 3 ? 'active' : ''}}"
            data-days="3"
            bindtap="setSafetyDays"
          >3å¤©</view>
          <view 
            class="option-btn {{safetyStockDays === 5 ? 'active' : ''}}"
            data-days="5"
            bindtap="setSafetyDays"
          >5å¤©</view>
          <view 
            class="option-btn {{safetyStockDays === 7 ? 'active' : ''}}"
            data-days="7"
            bindtap="setSafetyDays"
          >7å¤©</view>
        </view>
      </view>
    </view>

    <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
    <view class="overview-cards" wx:if="{{restockStats.total > 0}}">
      <view class="overview-card total">
        <text class="card-icon">ğŸ“¦</text>
        <text class="card-value">{{restockStats.total}}</text>
        <text class="card-label">éœ€è¡¥è´§</text>
      </view>
      <view class="overview-card urgent">
        <text class="card-icon">ğŸ”´</text>
        <text class="card-value">{{restockStats.urgent}}</text>
        <text class="card-label">ç´§æ€¥</text>
      </view>
      <view class="overview-card warning">
        <text class="card-icon">ğŸŸ </text>
        <text class="card-value">{{restockStats.warning}}</text>
        <text class="card-label">å°½å¿«</text>
      </view>
    </view>

    <!-- è¡¥è´§åˆ—è¡¨ -->
    <view class="restock-list" wx:if="{{restockSuggestions.length > 0}}">
      <view 
        class="restock-item {{item.days_until_stockout < 3 ? 'critical' : item.days_until_stockout < 7 ? 'warning' : 'normal'}}"
        wx:for="{{restockSuggestions}}"
        wx:key="sku_id"
      >
        <view class="item-header">
          <view class="urgency-badge">
            <text>{{item.days_until_stockout < 3 ? 'ğŸ”´ ç´§æ€¥' : item.days_until_stockout < 7 ? 'ğŸŸ  å°½å¿«' : 'ğŸŸ¡ æ³¨æ„'}}</text>
          </view>
          <text class="item-name">{{item.name}}</text>
        </view>
        
        <view class="item-data">
          <view class="data-item">
            <text class="data-label">ç°æœ‰</text>
            <text class="data-value">{{item.current_stock}}ä»¶</text>
          </view>
          <view class="data-arrow">â†’</view>
          <view class="data-item highlight">
            <text class="data-label">å»ºè®®è¡¥</text>
            <text class="data-value">{{item.suggested_restock}}ä»¶</text>
          </view>
        </view>
        
        <view class="item-forecast">
          <text class="forecast-text">â³ çº¦ {{item.days_until_stockout}} å¤©åå–å®Œ</text>
          <text class="daily-sales">æ¯å¤©çº¦å– {{item.predicted_daily_sales}} ä»¶</text>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="good-state" wx:if="{{restockSuggestions.length === 0}}">
      <text class="good-icon">âœ…</text>
      <text class="good-text">å¤ªæ£’äº†ï¼æ‰€æœ‰å•†å“åº“å­˜å……è¶³</text>
    </view>
  </view>

  <!-- å¼‚å¸¸æ£€æµ‹ -->
  <view class="tab-content" wx:if="{{activeTab === 'anomaly' && !loading}}">
    <!-- è®¾ç½®åŒºåŸŸ -->
    <view class="settings-section">
      <view class="setting-row">
        <text class="setting-label">ğŸ“… æ£€æµ‹å‘¨æœŸ</text>
        <view class="setting-options">
          <view 
            class="option-btn {{days === 7 ? 'active' : ''}}"
            data-days="7"
            bindtap="setDays"
          >7å¤©</view>
          <view 
            class="option-btn {{days === 15 ? 'active' : ''}}"
            data-days="15"
            bindtap="setDays"
          >15å¤©</view>
          <view 
            class="option-btn {{days === 30 ? 'active' : ''}}"
            data-days="30"
            bindtap="setDays"
          >30å¤©</view>
        </view>
      </view>
    </view>

    <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
    <view class="overview-cards" wx:if="{{anomalyStats.total > 0}}">
      <view class="overview-card total">
        <text class="card-icon">ğŸ”</text>
        <text class="card-value">{{anomalyStats.total}}</text>
        <text class="card-label">å‘ç°å¼‚å¸¸</text>
      </view>
      <view class="overview-card surge">
        <text class="card-icon">ğŸ“ˆ</text>
        <text class="card-value">{{anomalyStats.surge}}</text>
        <text class="card-label">å–å¤š</text>
      </view>
      <view class="overview-card drop">
        <text class="card-icon">ğŸ“‰</text>
        <text class="card-value">{{anomalyStats.drop}}</text>
        <text class="card-label">å–å°‘</text>
      </view>
    </view>

    <!-- å¼‚å¸¸åˆ—è¡¨ -->
    <view class="anomaly-list" wx:if="{{anomalies.length > 0}}">
      <view 
        class="anomaly-item {{item.anomaly_type}}"
        wx:for="{{anomalies}}"
        wx:key="index"
      >
        <view class="anomaly-header">
          <view class="type-badge {{item.anomaly_type}}">
            <text>{{item.anomaly_type === 'surge' ? 'ğŸ“ˆ å–å¾—å¤š' : item.anomaly_type === 'drop' ? 'ğŸ“‰ å–å¾—å°‘' : 'âš ï¸ æ²¡å–å‡º'}}</text>
          </view>
          <text class="anomaly-date">{{item.date}}</text>
        </view>
        
        <text class="anomaly-name">{{item.name}}</text>
        
        <view class="sales-compare">
          <view class="compare-item">
            <text class="compare-label">å¹³æ—¶å–</text>
            <text class="compare-value">{{item.expected_sales}}ä»¶</text>
          </view>
          <view class="compare-arrow">
            {{item.anomaly_type === 'surge' ? 'â†‘' : 'â†“'}}
          </view>
          <view class="compare-item">
            <text class="compare-label">è¿™å¤©å–</text>
            <text class="compare-value highlight">{{item.actual_sales}}ä»¶</text>
          </view>
        </view>
        
        <view class="possible-reasons" wx:if="{{item.possible_reasons && item.possible_reasons.length > 0}}">
          <text class="reasons-title">å¯èƒ½åŸå› ï¼š</text>
          <view class="reasons-tags">
            <text class="reason-tag" wx:for="{{item.possible_reasons}}" wx:key="*this" wx:for-item="reason">{{reason}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="good-state" wx:if="{{anomalies.length === 0}}">
      <text class="good-icon">âœ…</text>
      <text class="good-text">æœªå‘ç°é”€å”®å¼‚å¸¸ï¼Œä¸€åˆ‡æ­£å¸¸</text>
    </view>
  </view>

  <!-- å¸®åŠ©è¯´æ˜ -->
  <view class="help-tip">
    <text class="tip-icon">ğŸ’¡</text>
    <text class="tip-text" wx:if="{{activeTab === 'restock'}}">ç³»ç»Ÿæ ¹æ®é”€å”®æƒ…å†µï¼Œè®¡ç®—æ¯ä¸ªå•†å“å¤§æ¦‚å¤šä¹…ä¼šå–å®Œ</text>
    <text class="tip-text" wx:if="{{activeTab === 'anomaly'}}">ç³»ç»Ÿä¼šå‘ç°é”€å”®å¼‚å¸¸ï¼Œå¸®æ‚¨åŠæ—¶å…³æ³¨</text>
  </view>
</view>
