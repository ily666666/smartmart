<view class="page-container">
  <!-- 搜索栏 -->
  <view class="search-bar">
    <view class="search-input-wrap">
      <text class="search-icon">🔍</text>
      <input 
        class="search-input" 
        placeholder="搜索商品名称或条码"
        value="{{searchQuery}}"
        bindinput="onSearchInput"
        bindconfirm="doSearch"
      />
      <view class="clear-btn" wx:if="{{searchQuery}}" bindtap="clearSearch">✕</view>
    </view>
    <view class="scan-btn" bindtap="scanProduct">
      <text class="scan-icon">📷</text>
    </view>
  </view>

  <!-- 分类筛选 -->
  <view class="category-scroll">
    <view 
      class="category-item {{selectedCategory === '' ? 'active' : ''}}"
      data-category=""
      bindtap="onCategoryChange"
    >
      全部
    </view>
    <view 
      class="category-item {{selectedCategory === item ? 'active' : ''}}"
      wx:for="{{categories}}"
      wx:key="*this"
      data-category="{{item}}"
      bindtap="onCategoryChange"
    >
      {{item}}
    </view>
  </view>

  <!-- 商品统计 -->
  <view class="stats-bar" wx:if="{{products.length > 0}}">
    <text class="stats-text">共 {{totalCount}} 件商品</text>
  </view>

  <!-- 商品列表 -->
  <view class="product-list" wx:if="{{products.length > 0}}">
    <view 
      class="product-item"
      wx:for="{{products}}"
      wx:key="id"
      data-id="{{item.id}}"
      bindtap="viewProduct"
    >
      <view class="product-image">
        <!-- 优先使用 base64， 显示图片 -->
        <image 
          wx:if="{{item.imageBase64 || item.image_url}}"
          src="{{item.imageBase64 || item.image_url}}"
          mode="aspectFill"
        />
        <view class="no-image" wx:elif="{{!item.image_url}}">📦</view>
        <view class="image-loading" wx:elif="{{item.image_url && !item.imageBase64}}">
          <text>...</text>
        </view>
      </view>
      <view class="product-info">
        <text class="product-name">{{item.name}}</text>
        <text class="product-barcode">{{item.barcode}}</text>
        <view class="product-meta">
          <text class="product-category">{{item.category}}</text>
          <text class="product-stock {{item.stock < 10 ? 'low' : ''}}">库存 {{item.stock}}</text>
        </view>
      </view>
      <view class="product-price">
        <text class="price-value">¥{{item.price}}</text>
        <text class="price-arrow">›</text>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{!loading && products.length === 0 && wsConnected}}">
    <text class="empty-icon">📦</text>
    <text class="empty-text">暂无商品</text>
    <text class="empty-hint">点击右下角添加商品</text>
  </view>

  <!-- 未连接状态 -->
  <view class="empty-state" wx:if="{{!wsConnected}}">
    <text class="empty-icon">🔌</text>
    <text class="empty-text">未连接服务器</text>
    <text class="empty-hint">请先在首页连接服务器</text>
  </view>

  <!-- 加载中 -->
  <view class="loading-more" wx:if="{{loading}}">
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 没有更多 -->
  <view class="no-more" wx:if="{{!hasMore && products.length > 0 && !loading}}">
    <text>没有更多了</text>
  </view>

  <!-- 添加按钮 -->
  <view class="fab-btn" bindtap="addProduct" wx:if="{{wsConnected}}">
    <text class="fab-icon">+</text>
  </view>
</view>
