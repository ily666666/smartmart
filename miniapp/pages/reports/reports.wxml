<view class="page-container">
  <!-- Tab åˆ‡æ¢ -->
  <view class="tab-bar">
    <view 
      class="tab-item {{activeTab === 'daily' ? 'active' : ''}}"
      data-tab="daily"
      bindtap="switchTab"
    >
      <text class="tab-icon">ğŸ“Š</text>
      <text class="tab-text">ä»Šæ—¥è¥ä¸š</text>
    </view>
    <view 
      class="tab-item {{activeTab === 'top' ? 'active' : ''}}"
      data-tab="top"
      bindtap="switchTab"
    >
      <text class="tab-icon">ğŸ”¥</text>
      <text class="tab-text">ç•…é”€æ’è¡Œ</text>
    </view>
    <view 
      class="tab-item {{activeTab === 'slow' ? 'active' : ''}}"
      data-tab="slow"
      bindtap="switchTab"
    >
      <text class="tab-icon">âš ï¸</text>
      <text class="tab-text">æ»é”€é¢„è­¦</text>
    </view>
    <view 
      class="tab-item {{activeTab === 'profit' ? 'active' : ''}}"
      data-tab="profit"
      bindtap="switchTab"
    >
      <text class="tab-icon">ğŸ’°</text>
      <text class="tab-text">ç›ˆåˆ©åˆ†æ</text>
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-state" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ä»Šæ—¥è¥ä¸š -->
  <view class="tab-content" wx:if="{{activeTab === 'daily' && !loading}}">
    <!-- æ—¥æœŸé€‰æ‹© -->
    <view class="date-selector">
      <view class="quick-dates">
        <view 
          class="quick-btn {{selectedDate === '' ? 'active' : ''}}"
          data-offset="0"
          bindtap="setQuickDate"
        >ä»Šå¤©</view>
        <view 
          class="quick-btn"
          data-offset="1"
          bindtap="setQuickDate"
        >æ˜¨å¤©</view>
        <view 
          class="quick-btn"
          data-offset="2"
          bindtap="setQuickDate"
        >å‰å¤©</view>
      </view>
      <picker mode="date" value="{{selectedDate}}" bindchange="onDateChange">
        <view class="date-picker-btn">ğŸ“… {{selectedDate}}</view>
      </picker>
    </view>

    <block wx:if="{{dailyReport}}">
      <!-- æ ¸å¿ƒæ•°æ® -->
      <view class="main-stat-card">
        <text class="main-stat-label">ä»Šæ—¥æ”¶å…¥</text>
        <text class="main-stat-value">Â¥{{dailyReport.total_revenue}}</text>
      </view>

      <view class="stat-grid">
        <view class="stat-card">
          <text class="stat-icon">ğŸ§¾</text>
          <text class="stat-value">{{dailyReport.order_count}}</text>
          <text class="stat-label">è®¢å•æ•°</text>
        </view>
        <view class="stat-card">
          <text class="stat-icon">ğŸ“¦</text>
          <text class="stat-value">{{dailyReport.item_count}}</text>
          <text class="stat-label">å”®å‡ºä»¶æ•°</text>
        </view>
        <view class="stat-card">
          <text class="stat-icon">ğŸ‘¤</text>
          <text class="stat-value">Â¥{{dailyReport.avg_order_value}}</text>
          <text class="stat-label">å®¢å•ä»·</text>
        </view>
      </view>

      <!-- ä»Šæ—¥çƒ­é”€ -->
      <view class="section" wx:if="{{dailyReport.top_products && dailyReport.top_products.length > 0}}">
        <view class="section-title">ğŸ”¥ ä»Šæ—¥çƒ­é”€</view>
        <view class="rank-list">
          <view class="rank-item" wx:for="{{dailyReport.top_products}}" wx:key="sku_id" wx:if="{{index < 5}}">
            <view class="rank-badge rank-{{index + 1}}">{{index + 1}}</view>
            <text class="rank-name">{{item.name}}</text>
            <view class="rank-stats">
              <text class="rank-qty">{{item.quantity}}ä»¶</text>
              <text class="rank-rev">Â¥{{item.revenue}}</text>
            </view>
          </view>
        </view>
      </view>
    </block>
  </view>

  <!-- ç•…é”€æ’è¡Œ -->
  <view class="tab-content" wx:if="{{activeTab === 'top' && !loading}}">
    <view class="time-selector">
      <view 
        class="time-btn {{days === 7 ? 'active' : ''}}"
        data-days="7"
        bindtap="setDays"
      >è¿‘7å¤©</view>
      <view 
        class="time-btn {{days === 15 ? 'active' : ''}}"
        data-days="15"
        bindtap="setDays"
      >è¿‘15å¤©</view>
      <view 
        class="time-btn {{days === 30 ? 'active' : ''}}"
        data-days="30"
        bindtap="setDays"
      >è¿‘30å¤©</view>
    </view>

    <view class="product-rank-list" wx:if="{{topProducts.length > 0}}">
      <view class="product-rank-item {{index < 3 ? 'top3' : ''}}" wx:for="{{topProducts}}" wx:key="sku_id">
        <view class="rank-medal">
          <text wx:if="{{index === 0}}">ğŸ¥‡</text>
          <text wx:elif="{{index === 1}}">ğŸ¥ˆ</text>
          <text wx:elif="{{index === 2}}">ğŸ¥‰</text>
          <text wx:else class="rank-num">{{index + 1}}</text>
        </view>
        <view class="product-info">
          <text class="product-name">{{item.name}}</text>
          <text class="product-stock">åº“å­˜ {{item.current_stock}} ä»¶</text>
        </view>
        <view class="product-stats">
          <text class="sold-qty">å–äº† {{item.quantity}} ä»¶</text>
          <text class="sold-rev">Â¥{{item.revenue}}</text>
        </view>
      </view>
    </view>

    <view class="empty-state" wx:else>
      <text class="empty-icon">ğŸ“­</text>
      <text class="empty-text">æš‚æ— æ•°æ®</text>
    </view>
  </view>

  <!-- æ»é”€é¢„è­¦ -->
  <view class="tab-content" wx:if="{{activeTab === 'slow' && !loading}}">
    <view class="time-selector">
      <view 
        class="time-btn {{days === 7 ? 'active' : ''}}"
        data-days="7"
        bindtap="setDays"
      >è¿‘7å¤©</view>
      <view 
        class="time-btn {{days === 15 ? 'active' : ''}}"
        data-days="15"
        bindtap="setDays"
      >è¿‘15å¤©</view>
      <view 
        class="time-btn {{days === 30 ? 'active' : ''}}"
        data-days="30"
        bindtap="setDays"
      >è¿‘30å¤©</view>
    </view>

    <view class="slow-list" wx:if="{{slowMovers.length > 0}}">
      <view class="warning-banner">
        âš ï¸ ä»¥ä¸‹ {{slowMovers.length}} ä¸ªå•†å“å–å¾—å¾ˆæ…¢
      </view>
      <view class="slow-item" wx:for="{{slowMovers}}" wx:key="sku_id">
        <text class="slow-name">{{item.name}}</text>
        <view class="slow-stats">
          <view class="slow-row">
            <text class="slow-label">è¿˜å‰©</text>
            <text class="slow-value stock">{{item.current_stock}} ä»¶</text>
          </view>
          <view class="slow-row">
            <text class="slow-label">{{days}}å¤©åªå–äº†</text>
            <text class="slow-value sold">{{item.quantity_sold}} ä»¶</text>
          </view>
          <view class="slow-row">
            <text class="slow-label">æŒ‰ç°åœ¨é€Ÿåº¦è¿˜è¦</text>
            <text class="slow-value days {{item.days_of_stock > 90 ? 'danger' : ''}}">
              {{item.days_of_stock > 999 ? 'å¾ˆä¹…å¾ˆä¹…' : item.days_of_stock + 'å¤©'}}
            </text>
          </view>
        </view>
      </view>
    </view>

    <view class="good-state" wx:else>
      <text class="good-icon">âœ…</text>
      <text class="good-text">å¤ªæ£’äº†ï¼æ²¡æœ‰æ»é”€å•†å“</text>
    </view>
  </view>

  <!-- ç›ˆåˆ©åˆ†æ -->
  <view class="tab-content" wx:if="{{activeTab === 'profit' && !loading}}">
    <view class="time-selector">
      <view 
        class="time-btn {{days === 7 ? 'active' : ''}}"
        data-days="7"
        bindtap="setDays"
      >è¿‘7å¤©</view>
      <view 
        class="time-btn {{days === 15 ? 'active' : ''}}"
        data-days="15"
        bindtap="setDays"
      >è¿‘15å¤©</view>
      <view 
        class="time-btn {{days === 30 ? 'active' : ''}}"
        data-days="30"
        bindtap="setDays"
      >è¿‘30å¤©</view>
    </view>

    <block wx:if="{{profitReport}}">
      <view class="profit-cards">
        <view class="profit-card revenue">
          <text class="profit-icon">ğŸ’°</text>
          <text class="profit-value">Â¥{{profitReport.total_revenue}}</text>
          <text class="profit-label">æ€»é”€å”®é¢</text>
        </view>
        <view class="profit-card cost">
          <text class="profit-icon">ğŸ’µ</text>
          <text class="profit-value">Â¥{{profitReport.total_cost}}</text>
          <text class="profit-label">æ€»æˆæœ¬</text>
        </view>
        <view class="profit-card profit">
          <text class="profit-icon">ğŸ“ˆ</text>
          <text class="profit-value {{profitReport.total_profit >= 0 ? 'positive' : 'negative'}}">
            Â¥{{profitReport.total_profit}}
          </text>
          <text class="profit-label">æ€»åˆ©æ¶¦</text>
        </view>
        <view class="profit-card margin">
          <text class="profit-icon">ğŸ“Š</text>
          <text class="profit-value">{{profitReport.profit_margin}}%</text>
          <text class="profit-label">åˆ©æ¶¦ç‡</text>
        </view>
      </view>

      <view class="info-tip" wx:if="{{profitReport.products_without_cost > 0}}">
        âš ï¸ æœ‰ {{profitReport.products_without_cost}} ä¸ªå•†å“æœªè®¾ç½®è¿›ä»·ï¼Œå·²æ’é™¤åœ¨ç»Ÿè®¡ä¹‹å¤–
      </view>
    </block>

    <view class="empty-state" wx:else>
      <text class="empty-icon">ğŸ“­</text>
      <text class="empty-text">æš‚æ— æ•°æ®</text>
    </view>
  </view>
</view>
