<!--pages/scan/scan.wxml-->
<view class="container">
  <!-- çŠ¶æ€æ  -->
  <view class="status-bar">
    <view class="status-item">
      <view class="status-dot {{wsConnected ? 'connected' : 'disconnected'}}"></view>
      <text>{{wsConnected ? 'å·²è¿æ¥' : 'æœªè¿æ¥'}}</text>
    </view>
    <text class="scan-count">å·²æ‰«æ: {{scanCount}}</text>
  </view>

  <!-- ä¸»å¡ç‰‡ï¼ˆæ•´åˆç›¸æœºå’Œæ“ä½œæ ï¼‰ -->
  <view class="main-card">
    <!-- ç›¸æœºåŒºåŸŸ -->
    <view class="camera-container">
      <camera 
        wx:if="{{cameraReady && wsConnected}}"
        class="camera"
        mode="scanCode"
        resolution="medium"
        flash="{{flashMode}}"
        bindscancode="onScanCode"
        binderror="onCameraError"
      >
        <!-- æ‰«ææ¡† -->
        <cover-view class="scan-overlay">
          <cover-view class="scan-frame">
            <cover-view class="corner corner-tl"></cover-view>
            <cover-view class="corner corner-tr"></cover-view>
            <cover-view class="corner corner-bl"></cover-view>
            <cover-view class="corner corner-br"></cover-view>
            <cover-view class="scan-line"></cover-view>
          </cover-view>
          <cover-view class="scan-tip">å°†æ¡ç æ”¾å…¥æ¡†å†…è‡ªåŠ¨æ‰«æ</cover-view>
        </cover-view>
      </camera>
      
      <!-- æœªè¿æ¥æç¤º -->
      <view class="camera-placeholder" wx:if="{{!wsConnected}}">
        <text class="placeholder-icon">ğŸ”Œ</text>
        <text class="placeholder-text">è¯·å…ˆè¿æ¥æœåŠ¡å™¨</text>
        <button class="btn-connect" bindtap="goHome">å»è¿æ¥</button>
      </view>
      
      <!-- ç›¸æœºåŠ è½½ä¸­ -->
      <view class="camera-placeholder" wx:if="{{wsConnected && !cameraReady}}">
        <text class="placeholder-icon">ğŸ“·</text>
        <text class="placeholder-text">ç›¸æœºåŠ è½½ä¸­...</text>
      </view>
    </view>

    <!-- åº•éƒ¨æ“ä½œæ ï¼ˆæ•´åˆåœ¨å¡ç‰‡å†…ï¼‰ -->
    <view class="action-bar">
      <view class="action-item" bindtap="toggleFlash">
        <text class="action-icon">{{flashMode === 'on' ? 'ğŸ”¦' : 'ğŸ’¡'}}</text>
        <text class="action-text">{{flashMode === 'on' ? 'å…³é—­' : 'é—ªå…‰ç¯'}}</text>
      </view>
      <view class="action-item" bindtap="manualScan">
        <text class="action-icon">ğŸ“±</text>
        <text class="action-text">ç³»ç»Ÿæ‰«ç </text>
      </view>
    </view>
  </view>

  <!-- æ‰«æå†å²å¡ç‰‡ -->
  <view class="history-section" wx:if="{{scanHistory.length}}">
    <view class="history-header">
      <text class="history-title">æ‰«æè®°å½•</text>
      <text class="history-clear" bindtap="clearHistory">æ¸…ç©º</text>
    </view>
    <scroll-view class="history-list" scroll-y>
      <view 
        class="history-item {{item.success ? 'success' : 'failed'}}"
        wx:for="{{scanHistory}}"
        wx:key="id"
      >
        <view class="history-icon">{{item.success ? 'âœ…' : 'âŒ'}}</view>
        <view class="history-info">
          <text class="history-name">{{item.name || item.code}}</text>
          <text class="history-code" wx:if="{{item.name}}">{{item.code}}</text>
        </view>
        <view class="history-right">
          <text class="history-price" wx:if="{{item.price}}">Â¥{{item.price}}</text>
          <text class="history-time">{{item.time}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- åº•éƒ¨åˆ‡æ¢æ  -->
  <view class="mode-switch-bar">
    <view class="mode-switch-inner">
      <view class="mode-btn active">
        <text class="mode-icon">ğŸ”</text>
        <text class="mode-text">æ‰«ç å½•å…¥</text>
      </view>
      <view class="mode-btn" bindtap="switchToVision">
        <text class="mode-icon">ğŸ‘ï¸</text>
        <text class="mode-text">AIè¯†åˆ«</text>
      </view>
    </view>
  </view>
</view>
